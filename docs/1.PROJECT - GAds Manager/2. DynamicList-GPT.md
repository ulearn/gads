🧩 Overall Design
Component	Description
Base List (static)	2 000 high-intent LOST leads pulled once and uploaded manually or via script (never deleted, gives Google a stable audience).
Dynamic Feed (active)	~200 contacts from your “B2C Pipeline Filtered” list — refreshed every few hours via API (adds new, removes old).
Google Ads Audience	One Customer Match list (e.g. ulearn_sql_master) — script adds and removes members as your feed changes.
⚙️ Step-by-Step API Flow (Node.js)
1️⃣ Initial base-list upload

Run once:

node sync_base.js


sync_base.js grabs 2 000 high-intent LOST deals, hashes their emails, and uploads them to create ulearn_sql_master.

2️⃣ Ongoing incremental updates

A second script runs on cron:

node sync_dynamic.js


This one:

Pulls current active SQLs from HubSpot (dealstage in [Inbox, Sequenced, Engaging, Responsive])

Compares to a cached JSON of last sync (last_sync.json)

Builds two arrays → toAdd[] and toRemove[]

Calls:

customer.user_lists.add_members(USERLIST_ID, toAdd)
customer.user_lists.remove_members(USERLIST_ID, toRemove)


Logs counts + updates the cache.

3️⃣ Example core logic (simplified)
const fs = require('fs');
const crypto = require('crypto');
const axios = require('axios');
const { GoogleAdsApi } = require('google-ads-api');
const env = process.env;

const hs = axios.create({
  baseURL: 'https://api.hubapi.com',
  headers: { Authorization: `Bearer ${env.HUBSPOT_TOKEN}` }
});

const gads = new GoogleAdsApi({
  client_id: env.GADS_CLIENT_ID,
  client_secret: env.GADS_CLIENT_SECRET,
  developer_token: env.GADS_DEV_TOKEN
});
const customer = gads.Customer({
  customer_account_id: env.GADS_ACCOUNT_ID,
  refresh_token: env.GADS_REFRESH_TOKEN
});

const sha256 = s => crypto.createHash('sha256').update(s.trim().toLowerCase()).digest('hex');
const CACHE = '/home/hub/public_html/ads/last_sync.json';
const USERLIST_ID = env.GADS_USERLIST_ID;

async function fetchActiveSQLs() {
  const res = await hs.post('/crm/v3/objects/contacts/search', {
    filterGroups: [{
      filters: [
        { propertyName: 'dealstage', operator: 'IN', values: ['inbox','sequenced','engaging','responsive'] },
        { propertyName: 'territory', operator: 'NEQ', value: 'unsupported' },
        { propertyName: 'email', operator: 'HAS_PROPERTY' }
      ]
    }],
    properties: ['email']
  });
  return res.data.results.map(c => sha256(c.properties.email));
}

async function sync() {
  const nowList = new Set(await fetchActiveSQLs());
  const prevList = new Set(fs.existsSync(CACHE) ? JSON.parse(fs.readFileSync(CACHE)) : []);
  const toAdd = [...nowList].filter(e => !prevList.has(e)).map(e => ({ user_identifiers: [{ hashed_email: e }] }));
  const toRemove = [...prevList].filter(e => !nowList.has(e)).map(e => ({ user_identifiers: [{ hashed_email: e }] }));

  if (toAdd.length) await customer.user_lists.add_members(USERLIST_ID, toAdd);
  if (toRemove.length) await customer.user_lists.remove_members(USERLIST_ID, toRemove);

  fs.writeFileSync(CACHE, JSON.stringify([...nowList], null, 2));
  console.log(`✅ Added ${toAdd.length}, Removed ${toRemove.length}`);
}

sync();

4️⃣ Schedule it
0 */3 * * * node /home/hub/public_html/ads/sync_dynamic.js >> /home/hub/public_html/ads/sql-sync.log 2>&1

✅ Result

Stable base of LOST + live feed of hot leads

Audience never drops below 2 000 → always eligible

New SQLs appear in Google Ads within hours

Old/WON/LOST SQLs auto-removed

Would you like me to write the ready-to-deploy sync_dynamic.js and sync_base.js scripts (with .env variable layout + cron comments) so you can drop them straight into /home/hub/public_html/ads/?