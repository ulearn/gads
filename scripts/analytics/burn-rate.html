<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìä Burn Rate Analysis Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        .header h1 {
            font-size: 28px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .header .subtitle {
            opacity: 0.9;
            font-size: 14px;
            margin-top: 5px;
        }

        .header-controls {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .control-group label {
            font-size: 12px;
            opacity: 0.9;
            font-weight: 500;
        }

        .main-content {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .content-header {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            padding: 25px 30px;
            border-bottom: 2px solid #e2e8f0;
        }

        .section-title {
            font-size: 22px;
            color: #1e293b;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .filters {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .filter-select {
            padding: 10px 15px;
            border: 2px solid #e1e8ed;
            border-radius: 10px;
            font-size: 14px;
            outline: none;
            transition: border-color 0.3s ease;
            background: white;
            min-width: 150px;
        }

        .filter-select:focus {
            border-color: #3498db;
        }

        .refresh-btn {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: transform 0.2s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .refresh-btn:hover {
            transform: scale(1.05);
        }

        .content-body {
            padding: 30px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            border-left: 4px solid #667eea;
            transition: transform 0.2s ease;
        }

        .stat-card:hover {
            transform: translateY(-2px);
        }

        .stat-value {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .burn-rate { color: #e74c3c; }
        .waste-contacts { color: #f39c12; }
        .total-contacts { color: #3498db; }
        .validation-rate { color: #27ae60; }
        .territories-count { color: #9b59b6; }

        .stat-label {
            font-size: 14px;
            color: #64748b;
            font-weight: 500;
        }

        .chart-container {
            background: white;
            padding: 25px;
            border-radius: 12px;
            margin: 20px 0;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }

        .chart-container h3 {
            color: #1e293b;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .campaign-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .campaign-table th {
            background: linear-gradient(45deg, #34495e, #2c3e50);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.85rem;
            letter-spacing: 1px;
        }

        .campaign-table td {
            padding: 15px;
            border-bottom: 1px solid #ecf0f1;
            vertical-align: top;
        }

        .campaign-table tr:hover {
            background-color: #f8f9fa;
        }

        .unsupported-contacts {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.85rem;
        }

        .campaign-name {
            font-weight: 600;
            color: #2c3e50;
        }

        .campaign-id {
            font-size: 0.85rem;
            color: #7f8c8d;
            margin-top: 2px;
        }

        .campaign-adgroup {
            font-size: 0.8rem;
            color: #95a5a6;
            font-style: italic;
            margin-top: 2px;
        }

        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 200px;
            color: #64748b;
            font-size: 16px;
        }

        .error {
            background: #fee2e2;
            color: #dc2626;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .success {
            background: #dcfce7;
            color: #16a34a;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .mql-validation-summary {
            background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
            padding: 25px;
            border-radius: 12px;
            margin: 20px 0;
        }

        .mql-validation-summary h3 {
            color: #1e293b;
            margin-bottom: 20px;
            font-size: 18px;
        }

        .validation-flow {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .validation-step {
            background: white;
            padding: 15px 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            flex: 1;
            min-width: 120px;
        }

        .validation-step .number {
            font-size: 20px;
            font-weight: 700;
            color: #3498db;
        }

        .validation-step .label {
            font-size: 12px;
            color: #64748b;
            margin-top: 5px;
        }

        .validation-arrow {
            font-size: 20px;
            color: #3498db;
        }

        #unsupportedTerritories {
            margin-top: 30px;
        }

        .territories-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .territory-card {
            background: linear-gradient(135deg, #fff5f5 0%, #fed7d7 100%);
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #e53e3e;
        }

        .territory-name {
            font-weight: 600;
            color: #742a2a;
            margin-bottom: 5px;
        }

        .territory-count {
            color: #c53030;
            font-size: 18px;
            font-weight: 700;
        }

        .territory-waste {
            font-size: 12px;
            color: #9c4221;
            margin-top: 5px;
        }

        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                text-align: center;
            }

            .header-controls {
                width: 100%;
                justify-content: center;
            }

            .filters {
                flex-direction: column;
                width: 100%;
            }

            .filter-select {
                width: 100%;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .campaign-table {
                font-size: 14px;
            }

            .validation-flow {
                flex-direction: column;
            }

            .validation-arrow {
                transform: rotate(90deg);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div>
                <h1>üî• Burn Rate Analysis Dashboard</h1>
                <div class="subtitle">Google Ads MQL Territory Validation & Waste Analysis</div>
            </div>
            <div class="header-controls">
                <div class="control-group">
                    <label>Date Range</label>
                    <select class="filter-select" id="timeRange">
                        <option value="7">Last 7 days</option>
                        <option value="30" selected>Last 30 days</option>
                        <option value="60">Last 60 days</option>
                        <option value="90">Last 90 days</option>
                    </select>
                </div>
                <div class="control-group">
                    <label>Campaign Filter</label>
                    <select class="filter-select" id="campaignFilter">
                        <option value="all">All Campaigns</option>
                        <!-- Populated by JavaScript -->
                    </select>
                </div>
            </div>
        </div>

        <div class="main-content">
            <div class="content-header">
                <h2 class="section-title">
                    üìä Enhanced Campaign Burn Rate Analysis
                </h2>
                <div class="filters">
                    <select class="filter-select" id="analysisMode">
                        <option value="pipeline">Pipeline Analysis</option>
                        <option value="revenue">Revenue Analysis</option>
                    </select>
                    <button class="refresh-btn" onclick="loadEnhancedBurnRateData()">
                        üîÑ Refresh Enhanced Data
                    </button>
                </div>
            </div>

            <div class="content-body">
                <div id="loadingSpinner" class="loading" style="display: none;">
                    <div>üîÑ Loading enhanced burn rate analysis...</div>
                </div>

                <div id="errorContainer"></div>
                <div id="successContainer"></div>
                <div id="debugInfo"></div>

                <div class="stats-grid" id="statsGrid">
                    <div class="stat-card">
                        <div class="stat-value burn-rate" id="burnRateValue">--</div>
                        <div class="stat-label">Burn Rate %</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value waste-contacts" id="wasteContactsValue">--</div>
                        <div class="stat-label">Wasted MQLs</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value total-contacts" id="totalMQLsValue">--</div>
                        <div class="stat-label">Total MQLs</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value validation-rate" id="validationRateValue">--</div>
                        <div class="stat-label">MQL‚ÜíSQL Rate</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value territories-count" id="sqlDealsValue">--</div>
                        <div class="stat-label">SQL Deals Created</div>
                    </div>
                </div>

                <!-- MQL Validation Summary -->
                <div class="mql-validation-summary" id="mqlValidationSummary" style="display: none;">
                    <h3>üéØ MQL ‚Üí SQL Validation Pipeline</h3>
                    <div class="validation-flow" id="validationFlow">
                        <!-- Will be populated by JavaScript -->
                    </div>
                </div>

                <div class="chart-container">
                    <h3>üìà Burn Rate Trends</h3>
                    <canvas id="burnRateChart" width="400" height="200"></canvas>
                </div>

                <table class="campaign-table" id="campaignTable" style="display: none;">
                    <thead>
                        <tr>
                            <th>Campaign Details</th>
                            <th>Total MQLs</th>
                            <th>SQLs Created</th>
                            <th>Won Deals</th>
                            <th>Revenue</th>
                            <th>MQL‚ÜíSQL Rate</th>
                            <th>Unsupported MQLs</th>
                            <th>Estimated Waste</th>
                        </tr>
                    </thead>
                    <tbody id="campaignTableBody">
                    </tbody>
                </table>

                <div id="unsupportedTerritories" style="margin-top: 30px;">
                    <h3 class="section-title">üö´ Unsupported Territories Detected</h3>
                    <div id="territoriesListContainer" class="territories-grid">
                        <!-- Will be populated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let burnRateChart;
        let campaignsData = [];

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            loadCampaignsDropdown();
            loadEnhancedBurnRateData();
            
            // Add event listeners
            document.getElementById('timeRange').addEventListener('change', loadEnhancedBurnRateData);
            document.getElementById('campaignFilter').addEventListener('change', loadEnhancedBurnRateData);
            document.getElementById('analysisMode').addEventListener('change', loadEnhancedBurnRateData);
        });

        async function loadCampaignsDropdown() {
            try {
                console.log('üéØ Loading campaigns for dropdown...');
                
                // Try to fetch campaigns from existing pipeline data endpoint
                const response = await fetch('/gads/analytics/pipeline-data?days=90');
                
                if (!response.ok) {
                    throw new Error('Pipeline data endpoint returned: ' + response.status);
                }
                
                const result = await response.json();
                
                if (result.success && result.campaigns) {
                    campaignsData = result.campaigns;
                    populateCampaignsDropdown(result.campaigns);
                    console.log('‚úÖ Loaded ' + result.campaigns.length + ' campaigns');
                } else {
                    console.warn('‚ö†Ô∏è No campaigns data received');
                    // Keep default "All Campaigns" option only
                }
            } catch (error) {
                console.error('‚ùå Failed to load campaigns:', error);
                console.log('üì° Using fallback - keeping default dropdown options');
                // Keep default "All Campaigns" option only
            }
        }

        function populateCampaignsDropdown(campaigns) {
            const select = document.getElementById('campaignFilter');
            
            // Keep "All Campaigns" option
            select.innerHTML = '<option value="all">All Campaigns</option>';
            
            // Add individual campaigns
            campaigns.forEach(function(campaign) {
                const option = document.createElement('option');
                option.value = campaign.name || campaign.id;
                option.textContent = campaign.name || ('Campaign ' + campaign.id);
                select.appendChild(option);
            });
            
            console.log('‚úÖ Populated dropdown with ' + campaigns.length + ' campaigns');
        }

        async function loadEnhancedBurnRateData() {
            const timeRange = document.getElementById('timeRange').value;
            const campaignFilter = document.getElementById('campaignFilter').value;
            const analysisMode = document.getElementById('analysisMode').value;
            const loadingSpinner = document.getElementById('loadingSpinner');
            const errorContainer = document.getElementById('errorContainer');
            const successContainer = document.getElementById('successContainer');
            const debugInfo = document.getElementById('debugInfo');
            const campaignTable = document.getElementById('campaignTable');
            
            // Show loading state
            loadingSpinner.style.display = 'flex';
            errorContainer.innerHTML = '';
            successContainer.innerHTML = '';
            debugInfo.innerHTML = '';
            campaignTable.style.display = 'none';
            
            try {
                console.log('üî• Loading burn rate data: ' + timeRange + ' days, campaign: ' + campaignFilter + ', mode: ' + analysisMode);
                
                // Try the enhanced endpoint first
                try {
                    const params = new URLSearchParams({
                        days: timeRange,
                        mode: analysisMode
                    });
                    
                    // Add campaign filter if not "all"
                    if (campaignFilter && campaignFilter !== 'all') {
                        params.append('campaign', campaignFilter);
                    }
                    
                    // First try the enhanced endpoint
                    const enhancedResponse = await fetch('/gads/analytics/burn-rate-enhanced?' + params.toString());
                    
                    if (enhancedResponse.ok) {
                        const enhancedData = await enhancedResponse.json();
                        
                        if (enhancedData.success) {
                            displayBurnRateData(enhancedData);
                            displayValidationSummary(enhancedData);
                            updateChart(enhancedData);
                            displayCampaignBreakdown(enhancedData);
                            displayUnsupportedTerritories(enhancedData);
                            
                            successContainer.innerHTML = 
                                '<div class="success">' +
                                    '‚úÖ Successfully loaded enhanced burn rate analysis for ' + (campaignFilter === 'all' ? 'all campaigns' : campaignFilter) +
                                    ' (' + timeRange + ' days, ' + (enhancedData.summary && enhancedData.summary.totalContacts ? enhancedData.summary.totalContacts : 0) + ' total MQLs)' +
                                '</div>';
                            return;
                        }
                    }
                    
                    // If enhanced endpoint failed, fall back to existing data endpoint
                    throw new Error('Enhanced endpoint not available, trying fallback...');
                    
                } catch (enhancedError) {
                    console.log('‚ö†Ô∏è Enhanced endpoint failed, trying existing burn-rate-data endpoint:', enhancedError.message);
                    
                    // Fallback to existing endpoint
                    const fallbackResponse = await fetch('/gads/analytics/burn-rate-data?days=' + timeRange);
                    
                    if (!fallbackResponse.ok) {
                        throw new Error('Fallback endpoint also failed: ' + fallbackResponse.status);
                    }
                    
                    const fallbackData = await fallbackResponse.json();
                    
                    // Display fallback data
                    displayFallbackData(fallbackData, campaignFilter, timeRange);
                    
                    successContainer.innerHTML = 
                        '<div class="success">' +
                            '‚úÖ Loaded burn rate data using fallback endpoint (' + timeRange + ' days)' +
                        '</div>';
                }
                
            } catch (error) {
                console.error('‚ùå Error loading burn rate data:', error);
                errorContainer.innerHTML = 
                    '<div class="error">' +
                        '<strong>Error:</strong> ' + error.message +
                        '<br><small>Check console for details. Verify backend endpoints are running.</small>' +
                    '</div>';
                
                // Show debug info
                debugInfo.innerHTML = 
                    '<div style="background: #f3f4f6; padding: 15px; border-radius: 8px; margin: 10px 0; font-family: monospace; font-size: 12px;">' +
                        '<strong>Debug Info:</strong><br>' +
                        '‚Ä¢ Enhanced endpoint: /gads/analytics/burn-rate-enhanced<br>' +
                        '‚Ä¢ Fallback endpoint: /gads/analytics/burn-rate-data<br>' +
                        '‚Ä¢ Parameters: days=' + timeRange + ', campaign=' + campaignFilter + '<br>' +
                        '‚Ä¢ Check that burn-rate-enhanced.js exists and index.js routes are added' +
                    '</div>';
            } finally {
                loadingSpinner.style.display = 'none';
            }
        }

        function displayBurnRateData(data) {
            const summary = data.summary || {};
            
            document.getElementById('burnRateValue').textContent = 
                summary.burnRate ? (summary.burnRate + '%') : '--';
            document.getElementById('wasteContactsValue').textContent = 
                summary.wastedContacts || summary.unsupportedContacts || '--';
            document.getElementById('totalMQLsValue').textContent = 
                summary.totalContacts || '--';
            document.getElementById('validationRateValue').textContent = 
                summary.validationRate ? (summary.validationRate + '%') : '--';
            document.getElementById('sqlDealsValue').textContent = 
                summary.sqlDeals || '--';
        }

        function displayFallbackData(data, campaignFilter, timeRange) {
            // Handle existing burn-rate-data endpoint format
            const summary = data.summary || data;
            
            document.getElementById('burnRateValue').textContent = 
                summary.burn_rate ? (summary.burn_rate + '%') : '--';
            document.getElementById('wasteContactsValue').textContent = 
                summary.unsupported_contacts || summary.wasted_contacts || '--';
            document.getElementById('totalMQLsValue').textContent = 
                summary.total_contacts || summary.totalContacts || '--';
            document.getElementById('validationRateValue').textContent = 
                summary.validation_rate ? (summary.validation_rate + '%') : '--';
            document.getElementById('sqlDealsValue').textContent = 
                summary.sql_deals || summary.contacts_with_deals || '--';
            
            // Show basic chart if data available
            if (data.timeseries || data.chartData) {
                updateChart({ chartData: data.timeseries || data.chartData });
            }
            
            // Show campaign info
            const campaignTable = document.getElementById('campaignTable');
            if (campaignFilter !== 'all') {
                campaignTable.style.display = 'none';
                document.getElementById('successContainer').innerHTML += 
                    '<div style="margin-top: 10px; padding: 10px; background: #fef3cd; border-radius: 5px; color: #856404;">' +
                        '‚ÑπÔ∏è Campaign filtering requires the enhanced endpoint. Showing data for all campaigns.' +
                    '</div>';
            }
        }

        function displayValidationSummary(data) {
            const mqlValidation = data.mqlValidation || {};
            const summary = document.getElementById('mqlValidationSummary');
            const flow = document.getElementById('validationFlow');
            
            if (Object.keys(mqlValidation).length > 0) {
                summary.style.display = 'block';
                
                flow.innerHTML = 
                    '<div class="validation-step">' +
                        '<div class="number">' + (mqlValidation.totalMQLs || 0) + '</div>' +
                        '<div class="label">Total MQLs</div>' +
                    '</div>' +
                    '<div class="validation-arrow">‚Üí</div>' +
                    '<div class="validation-step">' +
                        '<div class="number">' + (mqlValidation.territoryChecked || 0) + '</div>' +
                        '<div class="label">Territory Checked</div>' +
                    '</div>' +
                    '<div class="validation-arrow">‚Üí</div>' +
                    '<div class="validation-step">' +
                        '<div class="number">' + (mqlValidation.supportedTerritory || 0) + '</div>' +
                        '<div class="label">Supported Territory</div>' +
                    '</div>' +
                    '<div class="validation-arrow">‚Üí</div>' +
                    '<div class="validation-step">' +
                        '<div class="number">' + (mqlValidation.sqlsCreated || 0) + '</div>' +
                        '<div class="label">SQLs Created</div>' +
                    '</div>';
            } else {
                summary.style.display = 'none';
            }
        }

        function updateChart(data) {
            const ctx = document.getElementById('burnRateChart').getContext('2d');
            
            // Destroy existing chart if it exists
            if (burnRateChart) {
                burnRateChart.destroy();
            }
            
            const chartData = data.chartData || [];
            const labels = chartData.map(function(item) { return item.date || item.period; });
            const burnRates = chartData.map(function(item) { return item.burnRate || item.burn_rate_percentage || 0; });
            
            burnRateChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Burn Rate %',
                        data: burnRates,
                        borderColor: '#e74c3c',
                        backgroundColor: 'rgba(231, 76, 60, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        }
                    }
                }
            });
        }

        function displayCampaignBreakdown(data) {
            const campaigns = data.campaigns || [];
            const tableBody = document.getElementById('campaignTableBody');
            const campaignTable = document.getElementById('campaignTable');
            
            if (campaigns.length > 0) {
                tableBody.innerHTML = '';
                
                campaigns.forEach(function(campaign) {
                    const row = document.createElement('tr');
                    row.innerHTML = 
                        '<td>' +
                            '<div class="campaign-name">' + (campaign.name || 'Unknown Campaign') + '</div>' +
                            '<div class="campaign-id">ID: ' + (campaign.id || 'N/A') + '</div>' +
                            '<div class="campaign-adgroup">AdGroup: ' + (campaign.adgroup || 'N/A') + '</div>' +
                        '</td>' +
                        '<td>' + (campaign.totalMQLs || 0) + '</td>' +
                        '<td>' + (campaign.sqlsCreated || 0) + '</td>' +
                        '<td>' + (campaign.wonDeals || 0) + '</td>' +
                        '<td>‚Ç¨' + (campaign.revenue || 0).toLocaleString() + '</td>' +
                        '<td>' + (campaign.mqlSqlRate ? (campaign.mqlSqlRate + '%') : '0%') + '</td>' +
                        '<td>' +
                            '<span class="unsupported-contacts">' +
                                (campaign.unsupportedMQLs || 0) +
                            '</span>' +
                        '</td>' +
                        '<td>‚Ç¨' + (campaign.estimatedWaste || 0).toLocaleString() + '</td>';
                    tableBody.appendChild(row);
                });
                
                campaignTable.style.display = 'table';
            } else {
                campaignTable.style.display = 'none';
            }
        }

        function displayUnsupportedTerritories(data) {
            const territories = data.unsupportedTerritories || [];
            const container = document.getElementById('territoriesListContainer');
            
            if (territories.length > 0) {
                container.innerHTML = '';
                
                territories.forEach(function(territory) {
                    const card = document.createElement('div');
                    card.className = 'territory-card';
                    card.innerHTML = 
                        '<div class="territory-name">' + (territory.name || 'Unknown Territory') + '</div>' +
                        '<div class="territory-count">' + (territory.count || 0) + ' MQLs</div>' +
                        '<div class="territory-waste">Est. waste: ‚Ç¨' + (territory.estimatedWaste || 0).toLocaleString() + '</div>';
                    container.appendChild(card);
                });
            } else {
                container.innerHTML = '<div class="territory-card"><div class="territory-name">No unsupported territories detected</div></div>';
            }
        }
    </script>
</body>
</html>